apiVersion: skaffold/v4beta13
kind: Config
metadata:
  name: mathtrail

# Default: deploy everything
requires:
  - path: ../mathtrail-infra
  - path: ../mathtrail-infra-local
  - path: ../mathtrail-infra-observability
  - path: ../mathtrail-infra-testing
  - path: ../mathtrail-infra-chaos
  - path: ../mathtrail-identity
  - path: ../mathtrail-mentor
  - path: ../mathtrail-profile

profiles:
  # ── Infrastructure ───────────────────────────────────────────
  - name: infra
    patches:
      - op: replace
        path: /requires
        value:
          - path: ../mathtrail-infra

  - name: infra-local
    patches:
      - op: replace
        path: /requires
        value:
          - path: ../mathtrail-infra-local

  - name: infra-testing
    patches:
      - op: replace
        path: /requires
        value:
          - path: ../mathtrail-infra-testing

  - name: infra-chaos
    patches:
      - op: replace
        path: /requires
        value:
          - path: ../mathtrail-infra-chaos

  - name: infra-observability
    patches:
      - op: replace
        path: /requires
        value:
          - path: ../mathtrail-infra-observability

  # ── Services ─────────────────────────────────────────────────
  - name: mentor
    patches:
      - op: replace
        path: /requires
        value:
          - path: ../mathtrail-mentor

  - name: identity
    patches:
      - op: replace
        path: /requires
        value:
          - path: ../mathtrail-identity

  - name: profile
    patches:
      - op: replace
        path: /requires
        value:
          - path: ../mathtrail-profile

  # ── Combined ─────────────────────────────────────────────────
  - name: all-infra
    patches:
      - op: replace
        path: /requires
        value:
          - path: ../mathtrail-infra
          - path: ../mathtrail-infra-local
          - path: ../mathtrail-infra-observability
          - path: ../mathtrail-infra-testing
          - path: ../mathtrail-infra-chaos

  - name: all-services
    patches:
      - op: replace
        path: /requires
        value:
          - path: ../mathtrail-identity
          - path: ../mathtrail-mentor
          - path: ../mathtrail-profile
