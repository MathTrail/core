План №2: Реализация CI Pipeline с k6 и Kafka
Цель: Создать сквозной пайплайн, который проверяет не только код, но и производительность всей цепочки событий.

Запрос для Claude:

«Реализуй GitHub Actions Workflow для микросервиса MathTrail, который запускается на нашем Self-Hosted агенте. Пайплайн должен проверять всю цепочку: API -> Postgres -> Debezium -> Flink -> Kafka.

Этапы пайплайна:

Build: Сборка Go-микросервиса и кастомного бинара k6 с расширением xk6-kafka (используй Docker multi-stage build).

Ephemeral Env: >     * Поднятие кластера k3d с уникальным ID билда.

Деплой инфраструктуры (Postgres, Kafka, Apicurio, Flink Operator) через Helm.

Деплой самого микросервиса.

Test Suite (k6): Напиши сценарий integration_test.js, который:

Использует HTTP для создания сущности в микросервисе.

Использует Kafka Consumer (xk6-kafka) для ожидания обогащенного события в результирующем топике.

Asserts: Проверяет время сквозного прохождения (E2E latency) и корректность данных.

Observability: >     * Сконфигурируй отправку результатов k6 в наш OpenTelemetry Collector.

В случае провала теста — команда на сбор логов из Loki и трейсов из Tempo (через API Grafana) и вывод ссылки в комментарий к Pull Request.

Security: Убедись, что все секреты (токены БД, ключи Kafka) прокидываются через GitHub Secrets и не светятся в логах.»